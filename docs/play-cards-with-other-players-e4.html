<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<!-- Favicon -->
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="./favicons/apple-touch-icon.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="./favicons/favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="./favicons/favicon-16x16.png"
		/>
		<link rel="manifest" href="./favicons/site.webmanifest" />
		<link
			rel="mask-icon"
			href="./favicons/safari-pinned-tab.svg"
			color="#0ca4a5"
		/>
		<link rel="shortcut icon" href="./favicons/favicon.ico" />
		<link rel="icon" href="./favicons/favicon.png" />

		<!-- Tell browser this site is responsive -->
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!-- Tell browser this site supports light and dark mode -->
		<meta name="color-scheme" content="light dark" />
		<!-- Color for browser url bar in mobile/Safari -->
		<meta name="theme-color" media="(prefers-color-scheme: light)" content="#b28cf2" />
		<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#4612A1" />
		<!-- Disable Google FLOC -->
		<meta http-equiv="Permissions-Policy" content="interest-cohort=()" />

		<script>
			// Calling this here so that it loads as quickly as possible
			// Avoiding a flash of light mode in case dark mode is used
			const theme = localStorage.getItem('theme-preference') || 'auto';
			document.firstElementChild?.setAttribute('data-theme', theme);
		</script>

		
		<link href="./_app/immutable/assets/0.13484673.css" rel="stylesheet">
		<link href="./_app/immutable/assets/2.a0c51d5a.css" rel="stylesheet">
		<link href="./_app/immutable/assets/Footer.d783561c.css" rel="stylesheet">
		<link href="./_app/immutable/assets/Socials.1c0e54d1.css" rel="stylesheet">
		<link href="./_app/immutable/assets/ContentSection.3fd00a97.css" rel="stylesheet">
		<link href="./_app/immutable/assets/Image.0954db74.css" rel="stylesheet">
		<link rel="modulepreload" href="./_app/immutable/entry/start.744dc5ab.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/index.72d13981.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/index.b57f6985.js">
		<link rel="modulepreload" href="./_app/immutable/entry/app.f5f7ded2.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/0.db0ee529.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/2.9ccfe707.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Footer.133bab0a.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Socials.fc8e6cf9.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/ContentSection.26d0ed0f.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/regex.7dfa9b23.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/Image.552abca1.js">
		<link rel="modulepreload" href="./_app/immutable/chunks/meta.82364fc2.js">
		<link rel="modulepreload" href="./_app/immutable/nodes/12.f89a6662.js"><title>Make a multiplayer card game - Episode 4 - SvelteKit Static Blog Template</title><!-- HEAD_svelte-1ylu8nc_START --><meta name="keywords" content="Tutorial:Make a multiplayer card game, Svelte, SvelteKit, Template, Blog, Starter, Static Site">

		<meta name="description" content="Play cards with other players">
		<meta property="og:description" content="Play cards with other players">
		<meta name="twitter:description" content="Play cards with other players">
		<link rel="canonical" href="https://sveltekit-static-blog-template.vercel.app//play-cards-with-other-players-e4">

		
		<meta property="og:title" content="Make a multiplayer card game - Episode 4 - SvelteKit Static Blog Template">
		<meta name="twitter:title" content="Make a multiplayer card game - Episode 4 - SvelteKit Static Blog Template">

		<meta property="og:image" content="https://sveltekit-static-blog-template.vercel.app//images/posts/blog-posts.jpg">
			<meta name="twitter:image" content="https://sveltekit-static-blog-template.vercel.app//images/posts/blog-posts.jpg"><!-- HEAD_svelte-1ylu8nc_END -->
	</head>
	<body data-sveltekit-preload-data="hover">
		<div id="svelte-root">



<div class="article-layout svelte-1hgysft"><header class="svelte-1gvg2a4 has-background"><nav class="container svelte-1gvg2a4"><a class="logo svelte-1gvg2a4" href="/" aria-label="Site logo"><div class="logo svelte-qu2viy animated"><svg id="logo-text" width="723.84009" height="116.720268" viewBox="0 0 723.84009 116.720269" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-qu2viy"><text xml:space="preserve" id="text" transform="translate(-278.77228,-206.83728)" class="svelte-qu2viy"><tspan x="275.57227" y="292.17088" id="tspan1319"><tspan style="font-size:106.667px;font-family:YoungSerif;" id="tspan1317">lizhiyu.me</tspan></tspan></text></svg>
</div></a>
		<div class="links svelte-1gvg2a4"><a href="/blog" class="svelte-1gvg2a4">Blog</a>
			<a href="/rss.xml" target="_blank" rel="noopener noreferrer" title="Subscribe to my RSS Feed" class="svelte-1llmev"><svg width="100%" height="100%" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 19C12 14.8 9.2 12 5 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19 19C19 10.6 13.4 5 5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5 19.01L5.01 18.9989" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg></a>
			<noscript>
	<style>.theme-toggle {
			display: none !important;
		}
	</style></noscript>
<button class="theme-toggle svelte-niuf71" title="Toggle between light and dark theme"><svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24"><mask id="moon" class="svelte-niuf71"><rect x="0" y="0" width="100%" height="100%" fill="white" class="svelte-niuf71"></rect><circle cx="40" cy="8" r="11" fill="black" class="svelte-niuf71"></circle></mask><circle id="sun" cx="12" cy="12" r="11" mask="url(#moon)" class="svelte-niuf71"></circle><g id="sun-beams" class="svelte-niuf71"><line x1="12" y1="1" x2="12" y2="3" class="svelte-niuf71"></line><line x1="12" y1="21" x2="12" y2="23" class="svelte-niuf71"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" class="svelte-niuf71"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" class="svelte-niuf71"></line><line x1="1" y1="12" x2="3" y2="12" class="svelte-niuf71"></line><line x1="21" y1="12" x2="23" y2="12" class="svelte-niuf71"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" class="svelte-niuf71"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" class="svelte-niuf71"></line></g></svg>
	<span class="label svelte-niuf71">Auto</span>
</button></div></nav>
</header>
	<main><article id="article-content" class="svelte-1hgysft"><div class="header svelte-1hgysft"><h1>Make a multiplayer card game - Episode 4</h1>
					<div class="note svelte-1hgysft">Published on 01 March 2021</div>
					
					<div class="note svelte-1hgysft">3 min read</div>
					<div class="tags svelte-1hgysft"><div class="tag primary svelte-1xh8qlg">Tutorial:Make a multiplayer card game</div></div></div>
			<div class="cover-image svelte-1hgysft"><img srcset="/images/posts/blog-posts.avif, /images/posts/blog-posts.webp, /images/posts/blog-posts.png" src="/images/posts/blog-posts.jpg" alt="Make a multiplayer card game - Episode 4" loading="lazy" decoding="async" class="svelte-1ykl0dj"></div>
			<div class="content svelte-1hgysft"><h2 id="make-a-multiplayer-card-game---episode-4--play-cards-with-other-players"><a class="heading-link" title="Permalink" aria-hidden="true" href="#make-a-multiplayer-card-game---episode-4--play-cards-with-other-players"><span>#</span></a>Make a multiplayer card game - Episode 4 | Play cards with other players</h2>
<blockquote><p>This section is a milestone in this series of tutorials, and after this
article, there will present a complete multiplayer local online card game.</p></blockquote>
<p>The key point of this section is how to link multiplayer to play.</p>
<h4 id="almost-all-changes-is-on-the-server-side"><a class="heading-link" title="Permalink" aria-hidden="true" href="#almost-all-changes-is-on-the-server-side"><span>#</span></a>Almost all changes is on the server side:</h4>
<p>We make a server and listen on “connection” event.</p>
<pre class="language-undefined"><!-- HTML_TAG_START --><code class="language-undefined">const net = require(&#39;net&#39;);
const server = net.createServer();
server.on(&quot;connection&quot;,()=&gt;&#123;&#125;);</code><!-- HTML_TAG_END --></pre>
<p>Then we generate a player ID and seat number for the player connecting.</p>
<pre class="language-undefined"><!-- HTML_TAG_START --><code class="language-undefined">var playerIDArr = [];
function generatePlayerIDAndSeatNumber() &#123;
    let _seat = playerIDArr.length;
    let _id = Math.floor(Math.random() * 10000);
    let _isExist = playerIDArr.indexOf(_id) != -1;
    if (_isExist) &#123;
        generatePlayerIDAndSeatNumber();
    &#125; else &#123;
        playerIDArr.push(_id);
    &#125;
    return &#123; id: _id, seat: _seat &#125;;
&#125;</code><!-- HTML_TAG_END --></pre>
<p>Back to the “connection” event, we assign some attributes on socket to make a
identification.</p>
<pre class="language-javascript"><!-- HTML_TAG_START --><code class="language-javascript">server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">let</span> _id_seat <span class="token operator">=</span> <span class="token function">generatePlayerIDAndSeatNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> _playerID <span class="token operator">=</span> _id_seat<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
  <span class="token keyword">let</span> _seatNumber <span class="token operator">=</span> _id_seat<span class="token punctuation">.</span>seat<span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span>id <span class="token operator">=</span> _playerID<span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span>seat <span class="token operator">=</span> _seatNumber<span class="token punctuation">;</span>
  socketDic<span class="token punctuation">[</span>_playerID<span class="token punctuation">]</span> <span class="token operator">=</span> socket<span class="token punctuation">;</span>

  <span class="token function">addSocketListener</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><!-- HTML_TAG_END --></pre>
<p>Add event listener to each socket, listen players’ interaction information
through data which cotain the command ID to route different game logic:</p>
<pre class="language-undefined"><!-- HTML_TAG_START --><code class="language-undefined">function addSocketListener(socket) &#123;
    socket.on(&#39;data&#39;, (data) =&gt; &#123;
        let _playerID = socket.id;
        decodeData(data, _playerID);
    &#125;);
    socket.on(&#39;error&#39;, (error) =&gt; &#123;
        //player disconnect
        console.log(error);
    &#125;);
&#125;</code><!-- HTML_TAG_END --></pre>
<p>the server forwards each player’s messages, which are divided into separate
sending and broadcasting.</p>
<pre class="language-undefined"><!-- HTML_TAG_START --><code class="language-undefined">//send to a specific player
function send(playerID, cmd, data) &#123;
    if (!mIsGaming) return;
    const _dataBuffer = encodeData(cmd, data);
    if (_dataBuffer) socketDic[playerID].write(_dataBuffer);
&#125;
//send to all players
function broadcast(cmd, data) &#123;
    if (!mIsGaming) return;
    const _dataBuffer = encodeData(cmd, data);
    if (_dataBuffer) &#123;
        let _keyArr = Object.keys(socketDic);
        for (let i = 0; i &lt; _keyArr.length; i++) &#123;
            let _socket = socketDic[_keyArr[i]];
            _socket.write(_dataBuffer);
        &#125;
    &#125;
&#125;</code><!-- HTML_TAG_END --></pre>
<p>That’s all the key points in this section, as above present, players can be
connect to a server and play with each other. You can check
<a href="https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode4" rel="nofollow">episode4 tag</a>
to see the complete code.</p>
<hr>
<p>The progress of the project up to this point have make a milestone, will not add
new content to the relevant repo main branch, excluding the subsequent
refactoring to prepare for the involvement of the game engine and framework.</p>
<p>The addition of new content will open another branch for development. Like each
episode, a tag will still be added after the chapter ends. You can find the
content of the corresponding chapter through the corresponding tag at any time.</p>
<p>In order to reflect the simplicity of native nodejs, I chose javascript. But I
have been developing with typescript in the past few years, is not very familiar
with javascript, which I must spend a little bit more time on debugging.</p>
<p>The content of the following chapters will expand rapidly. For either the
robustness of development or my proficiency. I will use typescript for new
content development and refactoring in later articles.</p>
<p><strong>The next episode, as the content list in the first episode, I will add game
engine Cocos Creator, before which I will make a refactory, besides move
javascript to typescript, but something about modularity.</strong></p>
<p>Thanks for your reading, and discussion is always welcome, I am very glad to
talk with you in below comment section😊.</p></div></article>
		<div class="container"><section id="related-posts" class="content-section top svelte-emrvls"><div class="title-area svelte-emrvls"><div class="text svelte-emrvls"><h2>Related Posts</h2>
				</div>
		</div>
	<div class="content-area svelte-emrvls"><div class="simple-grid svelte-ypk0wh"><a class="card blog-post-card no-image svelte-1kz16cj" href="/change-json-to-protocol-buffers-e3" target="_self" data-sveltekit-preload-data><div class="image svelte-1kz16cj"><div class="image" slot="image"></div></div>
	<div class="body svelte-1kz16cj"><div class="content svelte-1kz16cj"><div class="content svelte-1i7t6gt" slot="content"><p class="title svelte-1i7t6gt">Make a multiplayer card game - Episode 3</p>
		<div class="note svelte-1i7t6gt">3 min read</div>
		<p class="text svelte-1i7t6gt">Change JSON to Protocol Buffers</p></div></div>
		<div class="footer"><div class="footer svelte-1i7t6gt" slot="footer"><div class="tags svelte-1i7t6gt"><div class="tag primary svelte-1xh8qlg">Tutorial:Make a multiplayer card game</div></div></div></div></div>
</a><a class="card blog-post-card no-image svelte-1kz16cj" href="/create-2d-graphical-interface-with-react-e6" target="_self" data-sveltekit-preload-data><div class="image svelte-1kz16cj"><div class="image" slot="image"></div></div>
	<div class="body svelte-1kz16cj"><div class="content svelte-1kz16cj"><div class="content svelte-1i7t6gt" slot="content"><p class="title svelte-1i7t6gt">Make a multiplayer card game - Episode 6 | Create 2D graphical interface with React</p>
		<div class="note svelte-1i7t6gt">2 min read</div>
		<p class="text svelte-1i7t6gt">This section mainly uses react to implement UI views. Before this section, a UI view version has been implemented with cocos creator. In order to reuse the basic framework, we abstract the game logic and decouple the logic related to the view engine api.</p></div></div>
		<div class="footer"><div class="footer svelte-1i7t6gt" slot="footer"><div class="tags svelte-1i7t6gt"><div class="tag primary svelte-1xh8qlg">Tutorial:Make a multiplayer card game</div></div></div></div></div>
</a><a class="card blog-post-card no-image svelte-1kz16cj" href="/create-a-simple-server-and-client-from-scratch-e1" target="_self" data-sveltekit-preload-data><div class="image svelte-1kz16cj"><div class="image" slot="image"></div></div>
	<div class="body svelte-1kz16cj"><div class="content svelte-1kz16cj"><div class="content svelte-1i7t6gt" slot="content"><p class="title svelte-1i7t6gt">Make a multiplayer card game - Episode 1</p>
		<div class="note svelte-1i7t6gt">2 min read</div>
		<p class="text svelte-1i7t6gt">Create a simple server and client from scratch</p></div></div>
		<div class="footer"><div class="footer svelte-1i7t6gt" slot="footer"><div class="tags svelte-1i7t6gt"><div class="tag primary svelte-1xh8qlg">Tutorial:Make a multiplayer card game</div></div></div></div></div>
</a></div></div>
</section></div></main>
	<footer class="svelte-1m94jhe"><div class="wave"><svg width="100%" height="120" viewBox="0 0 1440 120" fill="none" style="transform: scale(-1,-1)" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" class="footer__wave"><path d="M0 0L48 8.875C96 17.9167 192 35.4167 288 53.3333C384 71.25 480 88.75 576 82.2083C672 75.4167 768 44.5833 864 26.6667C960 8.75 1056 4.58333 1152 11.125C1248 17.9167 1344 35.4167 1392 44.4583L1440 53.3333V120H1392C1344 120 1248 120 1152 120C1056 120 960 120 864 120C768 120 672 120 576 120C480 120 384 120 288 120C192 120 96 120 48 120H0V0Z" fill="var(--body-background-color)"></path></svg></div>
	<div class="content svelte-1m94jhe"><div class="copyright">This template was built by <a href="https://fantinel.dev?utm_source=site-template" target="_blank" rel="noopener noreferrer" class="svelte-1m94jhe">Matheus Fantinel</a>.
		</div>
		<div class="credits svelte-1m94jhe">Powered by <a href="https://kit.svelte.dev/" target="_blank" rel="noopener noreferrer" class="svelte-1m94jhe">SvelteKit</a>. Icons by
			<a href="https://iconoir.com/" target="_blank" rel="noopener noreferrer" class="svelte-1m94jhe">Iconoir</a>.
		</div>
		<div class="socials svelte-1m94jhe"><div class="socials svelte-t4kqcq">
	
	
	
	<a href="https://twitter.com/lychee_fish" target="_blank" rel="noopener noreferrer" title="Send an email" class="svelte-t4kqcq"><svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22.5 5.63a9.04 9.04 0 0 1-2.56 0.7 4.48 4.48 0 0 0 2-2.49 9 9 0 0 1-2.82 1.08 4.5 4.5 0 0 0-7.68 4.08 12.77 12.77 0 0 1-9.25-4.68 4.49 4.49 0 0 0 1.39 6 4.42 4.42 0 0 1-2.03-0.56v0.06a4.5 4.5 0 0 0 3.6 4.41 4.5 4.5 0 0 1-2.03 0.08 4.5 4.5 0 0 0 4.19 3.12 9 9 0 0 1-5.6 1.93A9.15 9.15 0 0 1 2 19.74a12.7 12.7 0 0 0 6.88 2.02c8.26 0 12.79-6.84 12.79-12.79v-0.61a9.13 9.13 0 0 0 2.24-2.33" fill="currentColor"></path></svg></a>
	<a href="mailto:lizhiyu.me@gmail.com" target="_blank" rel="noopener noreferrer" title="Send an email" class="svelte-t4kqcq"><svg width="100%" height="100%" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 9L12 12.5L17 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 17V7C2 5.89543 2.89543 5 4 5H20C21.1046 5 22 5.89543 22 7V17C22 18.1046 21.1046 19 20 19H4C2.89543 19 2 18.1046 2 17Z" stroke="currentColor" stroke-width="1.5"></path></svg></a>
</div>
			<a href="/rss.xml" target="_blank" rel="noopener noreferrer" title="Subscribe to my RSS Feed" class="svelte-1llmev"><svg width="100%" height="100%" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 19C12 14.8 9.2 12 5 12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M19 19C19 10.6 13.4 5 5 5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5 19.01L5.01 18.9989" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg></a>
			<noscript>
	<style>.theme-toggle {
			display: none !important;
		}
	</style></noscript>
<button class="theme-toggle svelte-niuf71" title="Toggle between light and dark theme"><svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24"><mask id="moon" class="svelte-niuf71"><rect x="0" y="0" width="100%" height="100%" fill="white" class="svelte-niuf71"></rect><circle cx="40" cy="8" r="11" fill="black" class="svelte-niuf71"></circle></mask><circle id="sun" cx="12" cy="12" r="11" mask="url(#moon)" class="svelte-niuf71"></circle><g id="sun-beams" class="svelte-niuf71"><line x1="12" y1="1" x2="12" y2="3" class="svelte-niuf71"></line><line x1="12" y1="21" x2="12" y2="23" class="svelte-niuf71"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" class="svelte-niuf71"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" class="svelte-niuf71"></line><line x1="1" y1="12" x2="3" y2="12" class="svelte-niuf71"></line><line x1="21" y1="12" x2="23" y2="12" class="svelte-niuf71"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36" class="svelte-niuf71"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22" class="svelte-niuf71"></line></g></svg>
	<span class="label svelte-niuf71">Auto</span>
</button></div></div>
</footer>
</div>

			
			<script>
				{
					__sveltekit_j5vw6t = {
						base: new URL(".", location).pathname.slice(0, -1),
						env: {}
					};

					const element = document.currentScript.parentElement;

					const data = [null,{"type":"data","data":{post:{title:"Make a multiplayer card game - Episode 4",slug:"play-cards-with-other-players-e4",coverImage:"/images/posts/blog-posts.jpg",date:"2021-03-01T21:55:15.361Z",excerpt:"Play cards with other players",tags:["Tutorial:Make a multiplayer card game"],html:"\u003Ch2 id=\"make-a-multiplayer-card-game---episode-4--play-cards-with-other-players\">\u003Ca class=\"heading-link\" title=\"Permalink\" aria-hidden=\"true\" href=\"#make-a-multiplayer-card-game---episode-4--play-cards-with-other-players\">\u003Cspan>#\u003C/span>\u003C/a>Make a multiplayer card game - Episode 4 | Play cards with other players\u003C/h2>\n\u003Cblockquote>\u003Cp>This section is a milestone in this series of tutorials, and after this\narticle, there will present a complete multiplayer local online card game.\u003C/p>\u003C/blockquote>\n\u003Cp>The key point of this section is how to link multiplayer to play.\u003C/p>\n\u003Ch4 id=\"almost-all-changes-is-on-the-server-side\">\u003Ca class=\"heading-link\" title=\"Permalink\" aria-hidden=\"true\" href=\"#almost-all-changes-is-on-the-server-side\">\u003Cspan>#\u003C/span>\u003C/a>Almost all changes is on the server side:\u003C/h4>\n\u003Cp>We make a server and listen on “connection” event.\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">const net = require(&#39;net&#39;);\nconst server = net.createServer();\nserver.on(&quot;connection&quot;,()=&gt;&#123;&#125;);\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Then we generate a player ID and seat number for the player connecting.\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">var playerIDArr = [];\nfunction generatePlayerIDAndSeatNumber() &#123;\n    let _seat = playerIDArr.length;\n    let _id = Math.floor(Math.random() * 10000);\n    let _isExist = playerIDArr.indexOf(_id) != -1;\n    if (_isExist) &#123;\n        generatePlayerIDAndSeatNumber();\n    &#125; else &#123;\n        playerIDArr.push(_id);\n    &#125;\n    return &#123; id: _id, seat: _seat &#125;;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Back to the “connection” event, we assign some attributes on socket to make a\nidentification.\u003C/p>\n\u003Cpre class=\"language-javascript\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-javascript\">server\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">on\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"connection\"\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token parameter\">socket\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token keyword\">let\u003C/span> _id_seat \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token function\">generatePlayerIDAndSeatNumber\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n  \u003Cspan class=\"token keyword\">let\u003C/span> _playerID \u003Cspan class=\"token operator\">=\u003C/span> _id_seat\u003Cspan class=\"token punctuation\">.\u003C/span>id\u003Cspan class=\"token punctuation\">;\u003C/span>\n  \u003Cspan class=\"token keyword\">let\u003C/span> _seatNumber \u003Cspan class=\"token operator\">=\u003C/span> _id_seat\u003Cspan class=\"token punctuation\">.\u003C/span>seat\u003Cspan class=\"token punctuation\">;\u003C/span>\n  socket\u003Cspan class=\"token punctuation\">.\u003C/span>id \u003Cspan class=\"token operator\">=\u003C/span> _playerID\u003Cspan class=\"token punctuation\">;\u003C/span>\n  socket\u003Cspan class=\"token punctuation\">.\u003C/span>seat \u003Cspan class=\"token operator\">=\u003C/span> _seatNumber\u003Cspan class=\"token punctuation\">;\u003C/span>\n  socketDic\u003Cspan class=\"token punctuation\">[\u003C/span>_playerID\u003Cspan class=\"token punctuation\">]\u003C/span> \u003Cspan class=\"token operator\">=\u003C/span> socket\u003Cspan class=\"token punctuation\">;\u003C/span>\n\n  \u003Cspan class=\"token function\">addSocketListener\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Add event listener to each socket, listen players’ interaction information\nthrough data which cotain the command ID to route different game logic:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">function addSocketListener(socket) &#123;\n    socket.on(&#39;data&#39;, (data) =&gt; &#123;\n        let _playerID = socket.id;\n        decodeData(data, _playerID);\n    &#125;);\n    socket.on(&#39;error&#39;, (error) =&gt; &#123;\n        //player disconnect\n        console.log(error);\n    &#125;);\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>the server forwards each player’s messages, which are divided into separate\nsending and broadcasting.\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">//send to a specific player\nfunction send(playerID, cmd, data) &#123;\n    if (!mIsGaming) return;\n    const _dataBuffer = encodeData(cmd, data);\n    if (_dataBuffer) socketDic[playerID].write(_dataBuffer);\n&#125;\n//send to all players\nfunction broadcast(cmd, data) &#123;\n    if (!mIsGaming) return;\n    const _dataBuffer = encodeData(cmd, data);\n    if (_dataBuffer) &#123;\n        let _keyArr = Object.keys(socketDic);\n        for (let i = 0; i &lt; _keyArr.length; i++) &#123;\n            let _socket = socketDic[_keyArr[i]];\n            _socket.write(_dataBuffer);\n        &#125;\n    &#125;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>That’s all the key points in this section, as above present, players can be\nconnect to a server and play with each other. You can check\n\u003Ca href=\"https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode4\" rel=\"nofollow\">episode4 tag\u003C/a>\nto see the complete code.\u003C/p>\n\u003Chr>\n\u003Cp>The progress of the project up to this point have make a milestone, will not add\nnew content to the relevant repo main branch, excluding the subsequent\nrefactoring to prepare for the involvement of the game engine and framework.\u003C/p>\n\u003Cp>The addition of new content will open another branch for development. Like each\nepisode, a tag will still be added after the chapter ends. You can find the\ncontent of the corresponding chapter through the corresponding tag at any time.\u003C/p>\n\u003Cp>In order to reflect the simplicity of native nodejs, I chose javascript. But I\nhave been developing with typescript in the past few years, is not very familiar\nwith javascript, which I must spend a little bit more time on debugging.\u003C/p>\n\u003Cp>The content of the following chapters will expand rapidly. For either the\nrobustness of development or my proficiency. I will use typescript for new\ncontent development and refactoring in later articles.\u003C/p>\n\u003Cp>\u003Cstrong>The next episode, as the content list in the first episode, I will add game\nengine Cocos Creator, before which I will make a refactory, besides move\njavascript to typescript, but something about modularity.\u003C/strong>\u003C/p>\n\u003Cp>Thanks for your reading, and discussion is always welcome, I am very glad to\ntalk with you in below comment section😊.\u003C/p>",readingTime:"3 min read",relatedPosts:[{title:"Make a multiplayer card game - Episode 3",slug:"change-json-to-protocol-buffers-e3",coverImage:"/images/posts/blog-posts.jpg",date:"2021-02-22T21:55:15.361Z",excerpt:"Change JSON to Protocol Buffers",tags:["Tutorial:Make a multiplayer card game"],html:"\u003Ch2 id=\"make-a-multiplayer-card-game---episode-3--change-json-to-protocol-buffers\">\u003Ca class=\"heading-link\" title=\"Permalink\" aria-hidden=\"true\" href=\"#make-a-multiplayer-card-game---episode-3--change-json-to-protocol-buffers\">\u003Cspan>#\u003C/span>\u003C/a>Make a multiplayer card game - Episode 3 | Change JSON to Protocol Buffers\u003C/h2>\n\u003Cblockquote>\u003Cp>Protocol buffers are a language-neutral, platform-neutral extensible mechanism\nfor serializing structured data. It has many advantages such as “Lesser in\nSize and Better in Performance”, like this article\n\u003Ca href=\"https://anuragthakur.hashnode.dev/protobuf-why-google-moved-from-json-to-protocol-buffers-ckdxb8sgi03kdjas17ril3fbi\" rel=\"nofollow\">Why Google moved from JSON to Protocol Buffers?\u003C/a>\nintroduce.\u003C/p>\u003C/blockquote>\n\u003Cp>I used it on all the projects I’ve worked on over the years. Besides the better\nperformance, what make me impressed is that the clean communication between\nclient and server with protocol buffers.\u003C/p>\n\u003Cblockquote>\u003Cp>You can clone\n\u003Ca href=\"https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode3\" rel=\"nofollow\">demo for episode3\u003C/a>\nwhich including all the bellow content.\u003C/p>\u003C/blockquote>\n\u003Cp>According to the\n\u003Ca href=\"https://github.com/protocolbuffers/protobuf\" rel=\"nofollow\">official tutorial\u003C/a>, two steps\nshould be done:\u003C/p>\n\u003Col>\u003Cli>Install the runtime library \u003Ccode>google-protobuf\u003C/code>:\u003Ccode>npm install\ngoogle-protobuf\u003C/code>.\u003C/li>\n\u003Cli>Get the Protocol Compiler \u003Ccode>protoc\u003C/code>: download from\n\u003Ca href=\"https://github.com/protocolbuffers/protobuf/releases\" rel=\"nofollow\">https://github.com/protocolbuffers/protobuf/releases\u003C/a>\u003C/li>\u003C/ol>\n\u003Cp>Then run a command like \u003Ccode>protoc —js_out=import_style=commonjs,binary:.\nmessages.proto base.proto\u003C/code>, you can get the \u003Ccode>.js\u003C/code> file from\u003C/p>\n\u003Ccode>.proto\u003C/code>.\n\u003Cp>When the \u003Ccode>.js\u003C/code> file generated, the protocol buffers environment is\nready.\u003C/p>\n\u003Cp>Back to our game, we should create a \u003Ccode>.proto\u003C/code> file, named\u003C/p>\n\u003Ccode>card-game.proto\u003C/code>.\n\u003Cp>The first line in \u003Ccode>.proto\u003C/code> file should be:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">syntax = &quot;proto3&quot;;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>which means which version of Protobuf we are using.\u003C/p>\n\u003Cp>Define the enum of Cmd:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">enum Cmd&#123;\n    NONE = 0;\n    READY_C2S = 1;\n    DEALCARDS_S2C = 2;\n    COMPETEFORLANDLORDROLE_C2S = 3;\n    PLAYTURN_S2C = 4;\n    PLAYCARDS_C2S = 5;\n    PLAYCARDS_S2C = 6;\n    ILLEGALCARDS_S2C = 7;\n    GAMEEND_S2C = 8;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>enum Cmd is for routing, will be introduced later.\u003C/p>\n\u003Cp>Define MainMessage message:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">message MainMessage&#123;\n    uint32 cmd_id = 1;\n    bytes data =2;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>In order to encapsulate the header and data body, we should assign serialized\nmessage to the data attribute.\u003C/p>\n\u003Cp>Define data message like:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">message DealCards_S2C&#123;\n    repeated uint32 cards = 1;\n    uint32 seat_number = 2;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Then, generate our own \u003Ccode>.js\u003C/code> file.\u003C/p>\n\u003Cp>As the episode3 demo show, run command bellow in directory proto.\u003C/p>\n\u003Cul>\u003Cli>\u003Cp>Windows\u003C/p>\n\u003Ccode>.\\protoc.exe --js_out=import_style=commonjs,binary:out\ncard-game.proto\u003C/code>\u003C/li>\n\u003Cli>\u003Cp>MacOS\u003C/p>\n\u003Ccode>./protoc --js_out=import_style=commonjs,binary:out\ncard-game.proto\u003C/code>\u003C/li>\u003C/ul>\n\u003Cp>Now, we have our own \u003Ccode>.js\u003C/code> file from the \u003Ccode>.proto\u003C/code> in which\nwe define message.\u003C/p>\n\u003Cp>Let’s encoding and decoding message with protocol buffers.\u003C/p>\n\u003Cp>Encoding: &gt;enum Cmd is used to map message type here\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">function encodeData(cmd, data) &#123;\n    let _proto_struct_obj;\n    switch (cmd) &#123;\n        case card_game_pb.Cmd.DEALCARDS_S2C:\n            _proto_struct_obj = new card_game_pb.DealCards_S2C();\n            _proto_struct_obj.setCardsList(data.cards);\n            _proto_struct_obj.setSeatNumber(data.seatNumber);\n            break;\n        case card_game_pb.Cmd.PLAYCARDS_S2C:\n            _proto_struct_obj = new card_game_pb.PlayCards_S2C();\n            _proto_struct_obj.setCardsList(data.cards);\n            _proto_struct_obj.setSeatNumber(data.seatNumber);\n            break;\n        case card_game_pb.Cmd.ILLEGALCARDS_S2C:\n            _proto_struct_obj = new card_game_pb.IllegalCards_S2C();\n            _proto_struct_obj.setSeatNumber(data.seatNumber);\n            break;\n        case card_game_pb.Cmd.GAMEEND_S2C:\n            _proto_struct_obj = new card_game_pb.GameEnd_S2C();\n            _proto_struct_obj.setSeatNumber(data.seatNumber);\n            break;\n        case card_game_pb.Cmd.PLAYTURN_S2C:\n            _proto_struct_obj = new card_game_pb.PlayTurn_S2C();\n            _proto_struct_obj.setHandCardsList(data.handCards);\n            _proto_struct_obj.setSeatNumber(data.seatNumber);\n            break;\n        default:\n            console.log(&quot;no message matched.&quot;)\n    &#125;\n    if (_proto_struct_obj) &#123;\n        let _mainMsg = new card_game_pb.MainMessage();\n        _mainMsg.setCmdId(cmd);\n        let _data = _proto_struct_obj.serializeBinary();\n        _mainMsg.setData(_data);\n        let _completeData = _mainMsg.serializeBinary();\n        return _completeData;\n    &#125;\n    return null;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Decoding: &gt;enum Cmd is used to map message type here\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">function decodeData(buffer) &#123;\n    let _mainMsg = card_game_pb.MainMessage.deserializeBinary(buffer);\n    let _cmd = _mainMsg.getCmdId();\n    let _bytesData = _mainMsg.getData();\n    let _data;\n    switch (_cmd) &#123;\n        case card_game_pb.Cmd.READY_C2S:\n            _data = card_game_pb.Ready_C2S.deserializeBinary(_bytesData);\n            _data = &#123;\n                seatNumber: _data.getSeatNumber()\n            &#125;\n            if (_this.ready_C2S) _this.ready_C2S(_data);\n            break;\n        case card_game_pb.Cmd.PLAYCARDS_C2S:\n            _data = card_game_pb.PlayCards_C2S.deserializeBinary(_bytesData);\n            _data = &#123;\n                cards: _data.getCardsList(),\n                seatNumber: _data.getSeatNumber()\n            &#125;\n            if (_this.playCards_C2S) _this.playCards_C2S(_data);\n            break;\n        case card_game_pb.Cmd.COMPETEFORLANDLORDROLE_C2S:\n            _data = card_game_pb.CompeteForLandLordRole_C2S.deserializeBinary(_bytesData);\n            _data = &#123;\n                score: _data.getScore(),\n                seatNumber: _data.getSeatNumber()\n            &#125;\n            if (_this.competeForLandLordRole_C2S) _this.competeForLandLordRole_C2S(_data);\n            break;\n        default:\n            console.log(&quot;no message matched.&quot;)\n    &#125;\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cblockquote>\u003Cp>Caution:\u003C/p>\n\u003Col>\u003Cli>Attributes defined as \u003Cstrong>seat_number\u003C/strong> in \u003Ccode>.proto\u003C/code> file should be\ncall like getSeatNumber and setSeatNumebr.\u003C/li>\n\u003Cli>Attributes defined as \u003Cstrong>repeated\u003C/strong> type in \u003Ccode>.proto\u003C/code> should call\ngetAttributeNameList and setAttributeList instead of the attribute self\nname.\u003C/li>\u003C/ol>\u003C/blockquote>",readingTime:"3 min read"},{title:"Make a multiplayer card game - Episode 6 | Create 2D graphical interface with React",slug:"create-2d-graphical-interface-with-react-e6",coverImage:"/images/posts/blog-posts.jpg",date:"2021-03-29T21:55:15.361Z",excerpt:"This section mainly uses react to implement UI views. Before this section, a UI view version has been implemented with cocos creator. In order to reuse the basic framework, we abstract the game logic and decouple the logic related to the view engine api.",tags:["Tutorial:Make a multiplayer card game"],html:"\u003Ch2 id=\"make-a-multiplayer-card-game---episode-6--create-2d-graphical-interface-with-react\">\u003Ca class=\"heading-link\" title=\"Permalink\" aria-hidden=\"true\" href=\"#make-a-multiplayer-card-game---episode-6--create-2d-graphical-interface-with-react\">\u003Cspan>#\u003C/span>\u003C/a>Make a multiplayer card game - Episode 6 | Create 2D graphical interface with React\u003C/h2>\n\u003Cp>This section mainly uses react to implement UI views. Before this section, a UI view version has been implemented with cocos creator. In order to reuse the basic framework, we abstract the game logic and decouple the logic related to the view engine api. The following is an abstracted interface:\u003C/p>\n\u003Cpre class=\"language-undefined\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-undefined\">export interface IGameSceneView &#123;\n    getViewComponent(name: string),\n    getNewViewComponent(comp),\n    getChild(childPath, parent),\n    addClickListener(comp, handler, target),\n    setCard(card, name),\n    setLabel(labelComp, text),\n    removeAllChildren(parent),\n    addChild(child, parent),\n    isCardSelected(card),\n    toggleCardSelectedStatus(card),\n    showComponent(comp),\n    hideComponent(comp)\n&#125;\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>Compared with cocos creator, the implementation of react is more operable at the code level. The styles of interface elements are all implemented by handwritten code. The hot-reload that comes with create-react-app also responds to changes very quickly. There is a time to switch editors and wait for the editor to refresh, which is very lightweight.\u003C/p>\n\u003Cp>Code reference \u003Ca href=\"https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode6-react\" rel=\"nofollow\">https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode6-react\u003C/a>\u003C/p>\n\u003Cp>The next article mainly introduces the comparison between cocos creator and react implementation in development.\u003C/p>\n\u003Cp>本节主要是用react实现UI视图。\n在本节之前，已经用cocos creator实现了一个UI视图版本，为了重用基础框架，我们将游戏逻辑进行抽象，并将与视图引擎api相关的逻辑解耦出来。\n下面是抽象出来的一个接口：\u003C/p>\n\u003Cpre class=\"language-typescript\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-typescript\">\u003Cspan class=\"token keyword\">export\u003C/span> \u003Cspan class=\"token keyword\">interface\u003C/span> \u003Cspan class=\"token class-name\">IGameSceneView\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n    \u003Cspan class=\"token function\">getViewComponent\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>name\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token builtin\">string\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">getNewViewComponent\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>comp\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">getChild\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>childPath\u003Cspan class=\"token punctuation\">,\u003C/span> parent\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">addClickListener\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>comp\u003Cspan class=\"token punctuation\">,\u003C/span> handler\u003Cspan class=\"token punctuation\">,\u003C/span> target\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">setCard\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>card\u003Cspan class=\"token punctuation\">,\u003C/span> name\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">setLabel\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>labelComp\u003Cspan class=\"token punctuation\">,\u003C/span> text\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">removeAllChildren\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>parent\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">addChild\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>child\u003Cspan class=\"token punctuation\">,\u003C/span> parent\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">isCardSelected\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>card\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">toggleCardSelectedStatus\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>card\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">showComponent\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>comp\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n    \u003Cspan class=\"token function\">hideComponent\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>comp\u003Cspan class=\"token punctuation\">)\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003Cp>相对于cocos creator，react的实现在代码层面可操作性较强，体现在界面元素的样式都通过手写代码来实现，create-react-app自带的hot-reload也非常快地反馈变更，不会有切换编辑器和等待编辑器刷新的时间，非常轻量的感觉。\u003C/p>\n\u003Cp>代码参考 \u003Ca href=\"https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode6-react\" rel=\"nofollow\">https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode6-react\u003C/a>\u003C/p>\n\u003Cp>下一篇主要介绍cocos creator 与 react 实现在开发上的对比。\u003C/p>",readingTime:"2 min read"},{title:"Make a multiplayer card game - Episode 1",slug:"create-a-simple-server-and-client-from-scratch-e1",coverImage:"/images/posts/blog-posts.jpg",date:"2021-02-01T21:55:15.361Z",excerpt:"Create a simple server and client from scratch",tags:["Tutorial:Make a multiplayer card game"],html:"\u003Ch2 id=\"make-a-multiplayer-card-game---episode-1--create-a-simple-server-and-client-from-scratch\">\u003Ca class=\"heading-link\" title=\"Permalink\" aria-hidden=\"true\" href=\"#make-a-multiplayer-card-game---episode-1--create-a-simple-server-and-client-from-scratch\">\u003Cspan>#\u003C/span>\u003C/a>Make a multiplayer card game - Episode 1 | Create a simple server and client from scratch\u003C/h2>\n\u003Cp>In the coming weeks, I’ll be updating a series of tutorials on making a\nmultiplayer online card games base on the rule of the most popular Chinese card\ngame “Doudizhu”, which means battle with landlord. I divide this series in many\nsmall part to make it easy for most friends. If you know a little javascript,\nall the better.\u003C/p>\n\u003Cp>Parts including:\u003C/p>\n\u003Cul>\u003Cli>create a simple server and client\u003C/li>\n\u003Cli>play cards in terminal with bots\u003C/li>\n\u003Cli>communicate with server by protobuf\u003C/li>\n\u003Cli>play cards in terminal with other players\u003C/li>\n\u003Cli>create 2D graphical interface with Cocos Creator\u003C/li>\n\u003Cli>create 2D graphical interface with React\u003C/li>\n\u003Cli>create 3D graphical interface with Three.js\u003C/li>\n\u003Cli>add physical lib ammo.js to add a tiny game\u003C/li>\n\u003Cli>connect to Web3 world\u003C/li>\u003C/ul>\n\u003Cp>\u003Cem>open your terminal, input \u003Ccode>node -v\u003C/code>, if something go wrong, please install\nnode.js first \u003Ca href=\"Link\">https://nodejs.org\u003C/a>.\u003C/em>\u003C/p>\n\u003Cp>directory structure :\n\u003Cimg src=\"https://cdn.hashnode.com/res/hashnode/image/upload/v1644775769474/2OAtz4Ljw.jpeg\" alt=\"demo0-document-tree.jpg\">\u003C/p>\n\u003Cp>create a server, server/index.js:\u003C/p>\n\u003Cdiv class=\"code-block svelte-1pkpsrg\">\n\t\n\t\u003Cpre class=\"language-ts\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-ts\">\u003Cspan class=\"token keyword\">const\u003C/span> net \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">require\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"net\"\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\n\u003Cspan class=\"token keyword\">const\u003C/span> server \u003Cspan class=\"token operator\">=\u003C/span> net\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">createServer\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  socket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">on\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"data\"\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>data\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n    \u003Cspan class=\"token function\">handlerData\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">,\u003C/span> data\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n  \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">handlerData\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">,\u003C/span> data\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token function\">send\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span> \u003Cspan class=\"token string-property property\">\"msg\"\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token string\">\"Welcome, friend.\"\u003C/span> \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">send\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>socket\u003Cspan class=\"token punctuation\">,\u003C/span> data\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token keyword\">let\u003C/span> bufferData \u003Cspan class=\"token operator\">=\u003C/span> Buffer\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">from\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token constant\">JSON\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">stringify\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>data\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n  socket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">write\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>bufferData\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n\nserver\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">listen\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token number\">8080\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token builtin\">console\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">log\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"server listening on 127.0.0.1:8080\"\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003C/div>\n\u003Cp>create client, client/index.js:\u003C/p>\n\u003Cdiv class=\"code-block svelte-1pkpsrg\">\n\t\n\t\u003Cpre class=\"language-ts\">\u003C!-- HTML_TAG_START -->\u003Ccode class=\"language-ts\">\u003Cspan class=\"token keyword\">const\u003C/span> net \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">require\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"net\"\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token keyword\">const\u003C/span> socket \u003Cspan class=\"token operator\">=\u003C/span> \u003Cspan class=\"token keyword\">new\u003C/span> \u003Cspan class=\"token class-name\">net\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">Socket\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\nsocket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">connect\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  host\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token string\">\"127.0.0.1\"\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n  port\u003Cspan class=\"token operator\">:\u003C/span> \u003Cspan class=\"token number\">8080\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> onConnected\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\nsocket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">on\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"data\"\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>buffer\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token function\">decode\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>buffer\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\nsocket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">on\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"error\"\u003C/span>\u003Cspan class=\"token punctuation\">,\u003C/span> \u003Cspan class=\"token punctuation\">(\u003C/span>buffer\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token operator\">=>\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token builtin\">console\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">log\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>buffer\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">onConnected\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token function\">startGame\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">decode\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>data\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token builtin\">console\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">log\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token constant\">JSON\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">parse\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>data\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>msg\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">request\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>data\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token keyword\">const\u003C/span> bufferData \u003Cspan class=\"token operator\">=\u003C/span> Buffer\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">from\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token constant\">JSON\u003C/span>\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">stringify\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">&#123;\u003C/span> \u003Cspan class=\"token string-property property\">\"msg\"\u003C/span>\u003Cspan class=\"token operator\">:\u003C/span> data \u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n  socket\u003Cspan class=\"token punctuation\">.\u003C/span>\u003Cspan class=\"token function\">write\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>bufferData\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\n\n\u003Cspan class=\"token keyword\">function\u003C/span> \u003Cspan class=\"token function\">startGame\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span> \u003Cspan class=\"token punctuation\">&#123;\u003C/span>\n  \u003Cspan class=\"token function\">request\u003C/span>\u003Cspan class=\"token punctuation\">(\u003C/span>\u003Cspan class=\"token string\">\"Hello, world!\"\u003C/span>\u003Cspan class=\"token punctuation\">)\u003C/span>\u003Cspan class=\"token punctuation\">;\u003C/span>\n\u003Cspan class=\"token punctuation\">&#125;\u003C/span>\u003C/code>\u003C!-- HTML_TAG_END -->\u003C/pre>\n\u003C/div>\n\u003Cp>run :\u003C/p>\n\u003Cp>\u003Ccode>cd server\u003C/code>\u003C/p>\n\u003Cp>\u003Ccode>node index.js\u003C/code>\u003C/p>\n\u003Cp>\u003Ccode>cd client\u003C/code>\u003C/p>\n\u003Cp>\u003Ccode>node index.js\u003C/code>\u003C/p>\n\u003Cp>result:\u003C/p>\n\u003Cp>\u003Cimg src=\"https://cdn.hashnode.com/res/hashnode/image/upload/v1644776034549/t-Jir1j9R.png\" alt=\"demo0-cmd-result.png\">\u003C/p>\n\u003Cp>This episode is end here, the complete demo can be found on\n\u003Ca href=\"https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode1\" rel=\"nofollow\">https://github.com/lizhiyu-me/Make-a-multiplayer-card-game/tree/episode1\u003C/a>\u003C/p>\n\u003Cp>Any problems, discussion is welcome.\u003C/p>\n\u003Cp>\u003Cstrong>In the next section, we will add the logic of Doudizhu game, and you will have\ncompleted a playable game in your terminal. \u003C/strong>\u003C/p>\n\u003Cp>Thanks for your reading.\u003C/p>",readingTime:"2 min read"}]}},"uses":{"url":1}},null];

					Promise.all([
						import("./_app/immutable/entry/start.744dc5ab.js"),
						import("./_app/immutable/entry/app.f5f7ded2.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 12],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
	</body>
</html>
